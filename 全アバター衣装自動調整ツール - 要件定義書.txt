全アバター衣装自動調整ツール - 要件定義書
1. プロジェクト概要
「全アバター衣装自動調整ツール」は、Unity上で動作するエディタ拡張で、異なるボーン構造を持つアバターと衣装の間で自動的に最適化を行い、様々なアバターに対して衣装を簡単に適用できるようにするものです。
2. 目的

異なるボーン構造・命名規則を持つアバターと衣装間での互換性を実現する
ユーザーの手作業による調整を最小限に抑え、直感的なUIで衣装の装着を可能にする
メッシュベースの調整とボーンベースの調整の両方をサポートし、様々なシチュエーションに対応する

3. 主要機能要件
3.1 ボーン識別・マッピング機能

命名規則解析: 様々な命名規則に対応したボーン名を解析し、ボーンの構成が異なっても対応できるようにする
階層的ボーン検索: 親子関係に基づいてボーンを特定する
空間位置に基づく検索: ボーンの相対的な位置情報から適切なボーンを特定する
マニュアルマッピング: ユーザーが手動でボーンの対応関係を編集できる機能
除外機能: 特定のボーンをマッピング対象から除外する機能

3.2 衣装調整機能
3.2.1 ボーンベース調整

ボーンの対応関係に基づいて衣装のスキンメッシュのボーン参照を自動的に修正
スキンメッシュのルートボーンを適切に設定
欠落ボーンに対してフォールバック設定を提供

3.2.2 メッシュベース調整

アバターのメッシュ形状に基づいて衣装メッシュを変形
身体部位ごと（頭、胴体、腕、脚など）に個別の調整を適用
参照点システムによる正確な部位特定と変形

3.3 微調整機能

スライダーによるリアルタイム微調整
全体スケール、上半身/下半身の位置オフセット、左右の腕/脚のスケール調整
部位別の詳細調整（胸部、腹部など）

3.4 UI/UX

ドラッグ＆ドロップによるアバターと衣装の選択
タブ分けされたインターフェース（基本設定、ボーンマッピング、詳細設定）
ボーンマッピングの視覚的表示（アバターボーン ⇔ 衣装ボーン）
フィルタリング機能によるボーン表示の絞り込み

4. 技術要件
4.1 システム要件

Unity 2019.4以降をサポート
ヒューマノイドリグを使用するアバターに対応

4.2 ボーン検出アルゴリズム

複数の検出方法（名前マッチング、階層解析、空間位置）の組み合わせによる高精度な検出
優先順位付けされた検出手法（直接名前マッチング → 階層解析 → 位置ベース）

4.3 メッシュ変形アルゴリズム

部位識別アルゴリズムによる適切な身体部位の検出
正規化座標系を使用した変形処理
参照点に基づく形状適合

5. データモデル
5.1 ボーン情報

ボーン名と正規化ボーン種類の対応テーブル
階層パス情報（ボーンの親子関係を表現）
空間位置パターン（体の相対的な位置を表現）

5.2 マッピング情報

アバターボーンから衣装ボーンへのマッピングテーブル
手動設定されたボーンマッピング
除外ボーンリスト

5.3 部位情報

メッシュ部位分類（頭、胴体、左腕、右腕、左脚、右脚など）
部位ごとの参照点データ（中心位置、範囲、端点など）

6. 処理フロー
6.1 基本フロー

アバターと衣装の選択
ボーン構造の解析
自動ボーンマッピングの生成
（必要に応じて）ユーザーによるマッピング調整
「衣装を着せる」操作
メッシュまたはボーンによる衣装の調整
（必要に応じて）微調整の適用

6.2 ボーンマッピング生成フロー

名前に基づく基本識別
名前の一致に基づくマッピング作成
階層構造に基づく未マッピングボーンの処理
位置情報に基づく残りのボーン処理
必要なボーンに対するフォールバックマッピングの適用

6.3 衣装適用フロー

既存の衣装インスタンスを削除
新しい衣装インスタンスを作成
衣装の位置とスケールを初期化
衣装調整方法（ボーンベースまたはメッシュベース）に基づいて処理
初期の微調整値を設定
エディタの更新を強制

7. 拡張性と将来の機能
7.1 プリセット管理

調整設定のセーブ・ロード
アバタータイプごとのプリセット管理

7.2 高度なマッピング

機械学習を用いたより正確なボーン推定
複雑なボーン階層の自動マッピング

7.3 対応モデル拡張

人型以外のモデル（動物、ファンタジーキャラクター等）へのサポート拡大

8. 制約と制限事項

極端に異なるボーン構造を持つ場合は完全な適合が難しい場合がある
特殊な形状の衣装や複雑なデフォーメーションには追加の手動調整が必要になる場合がある
過度に細分化されたメッシュ（数十万ポリゴン以上）の場合、処理に時間がかかる可能性がある

9. 成功指標

90%以上のケースでボーンの自動マッピングが正常に行われること
80%以上のケースで追加の手動調整なしで衣装が適切に装着できること
ユーザーが3クリック以内で衣装を装着できること

このツールは、Unity環境において異なるアバターと衣装の互換性問題を解決し、ユーザーが簡単に衣装をアバターに適用できるようにすることを目指します。

※GitHub APIのファイル更新制限に引っかからないファイルの長さにファイル内容を分解
※.metaファイルの作成は禁止
※Assetsフォルダの作成禁止
※Unityで完結することが難しい場合はBlenderの仕様をする(ユーザからBlenderの仕様がわからないように裏で処理を行う)
